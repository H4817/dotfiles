"use strict";var exports={};browsers.define("video",["jquery","utils","musicsig","downloads","observers"],function(a,b,c,d,e){var f={parseHttpQuery:function(a){var b={};return a.split("&").forEach(function(a){var c=a.split("=");b[c[0]]=decodeURIComponent(c[1])}),b},observeVideo:function(){f.addVideoDownLink(),e.watchSelector("#mv_layer_wrap",{subtree:!0,childList:!0},function(a){f.addVideoDownLink(a)},"video-observed")},getVideoExtensionByMimeType:function(a){var b="";switch(a){case"video/quicktime":case"video/x-quicktime":b="mov";break;case"video/avi":case"video/msvideo":case"video/x-msvideo":b="avi";break;case"video/x-mpeg":case"video/mpeg":b="mpeg";break;case"video/flv":case"video/x-flv":b="flv";break;case"video/mp4":case"video/x-mp4":b="mp4";break;case"video/MP2T":b="ts";break;case"video/3gpp":b="3gp";break;case"video/webm":case"video/x-webm":b="webm";break;case"video/wmv":case"video/ms-wmv":case"video/x-ms-wmv":b="wmv";break;case"video/animaflex":b="afl";break;case"video/x-ms-asf":case"video/x-ms-asf-plugin":b="asx";break;case"video/avs-video":b="avs";break;case"video/x-dv":b="dv";break;case"video/dl":case"video/x-dl":b="dl";break;case"video/fli":case"video/x-fli":b="fli";break;case"video/x-atomic3d-feature":b="fmf";break;case"video/gl":case"video/x-gl":b="gl";break;case"video/x-isvideo":b="isu";break;case"video/x-motion-jpeg":b="mjpg";break;case"video/x-sgi-movie":b="mv"}return b},addVideoDownLink:function(e){var g=a(".mv_data",e),h=a(".mv_share_actions:not(.download), .mv_actions_panel:not(.download)");if(h.length){var i=g.find("#video_player");if(i.length){var j=a("<div>").addClass("download_options"),k=a("<img/>").attr("src",browsers.extension.getURL("images/download.png")),l=a("<div>").addClass("download_label").text(c.lang("download")).prepend(k),m=a("<div>").addClass("download_control fl_l").hide().append(l).append(j);h.find(".mv_more").before(m).before('<div class="mv_rtl_divider fl_l"></div>'),m.next().hide();var n=b.trim(a("#mv_title").text()),o=function(b,c,e){if(e=e||"mpeg",b){var f=a("<div>").text(c).addClass("btn_download").click(function(a){a.stopPropagation(),d.download(b,n+" - "+c+"."+e)});return d.getRemoteFileLength(b,function(a){a>10&&f.append(" - "+d.bytesToStr(a))}),f.appendTo(j),m.show().next().show(),f}return null},p=function(b){var c=a("<div>").html(b).addClass("btn_download");return c.appendTo(j),m.show().next().show(),c},q=/:\/\/(www\.)?youtube\.com\/embed\/([^\?]+)/,r=/:\/\/(player\.)?vimeo\.com\/video\/([^\?]+)/,s=/\/\/(?:[^\.]+\.)?coub.com\/.*&coubID=([^&]+)/,t=i.attr("src")||i.find("#video_yt_player").attr("src");if(t&&q.test(t)){var u=q.exec(t)[2];browsers.ajax("https://www.youtube.com/get_video_info?video_id="+u,{dataType:"text",success:function(a){if(a=f.parseHttpQuery(a),a.url_encoded_fmt_stream_map){var b=a.url_encoded_fmt_stream_map.split(",");b.forEach(function(a){var b=f.parseHttpQuery(a),c=f.getVideoExtensionByMimeType(b.type.split(";")[0]);o(b.url,b.quality+" ["+c+"]",c)})}else a.reason&&p(a.reason.replace(/\+/g," "))}})}else if(t&&r.test(t))browsers.ajax(t.replace(/^http:/,"https:"),{dataType:"text",success:function(a){var b=/var\s+\w+=\{"[^;]+/;if(a=b.exec(a),a&&a.length)try{if(a=JSON.parse(a[0].replace(/^var\s+\w+=/,"")),a&&a.request&&a.request.files&&a.request.files.progressive){var c=a.request.files;c.progressive.forEach(function(a){o(a.url,a.quality+" ["+a.width+" x "+a.height+"]")})}}catch(d){}}});else if(t&&s.test(t)){var v=s.exec(t)[1];browsers.ajax("https://coub.com/coubs/"+v+".json",{dataType:"json",success:function(a){if(a){var b=a.file_versions&&a.file_versions.web;if(b.types.forEach(function(c){b.versions.forEach(function(d){var e=b.template.replace(/%\{type}/g,c).replace(/%\{version}/g,d),f=a.dimensions[d].join("x");o(e,f+" ["+c+"]",c)})}),a.gif_versions)for(var c in a.gif_versions)a.gif_versions.hasOwnProperty(c)&&o(a.gif_versions[c],c+" [gif]","gif")}else p("Failed to load video data")}})}else if(i.attr("flashvars")){var w=f.parseHttpQuery(i.attr("flashvars")),x=w.extra_data,y=w.url240,z=w.url360,A=w.url480,B=w.url720;o(x,"instagram","mp4"),o(y,"320x240"),o(z,"480x360"),o(A,"640x480"),o(B,"720x540")}h.addClass("download")}}}};return f},exports);