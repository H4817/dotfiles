"use strict";var exports={};browsers.define("vkontakte",["jquery","utils","musicsig","jqueryui"],function(a,b,c){var d={authorVkId:8849651,getMyID:function(){if(window.vkmyid)return window.vkmyid;d.getVar("vk.id",function(a){a&&(window.vkmyid=a)});var a=c.ge("nav");if(a)for(var b=0;b<a.childNodes.length;b++)if(a.childNodes[b].childNodes[0]){var e=a.childNodes[b].childNodes[0].href.match(/s(\d+)/);if(e&&e[1]){window.vkmyid=e[1];break}}},getVar:function(a,c){for(var d=a.split("."),e=window,f=0;f<d.length;f++){var g=d[f];if(e=e[g],b.isUndefined(e))break}c(e)},fmsg:null,addFriend:function(a,b){browsers.ajax("/id"+a,{success:function(c){var d=c.match(/Profile\.toggleFriend\(this, .(.*?).,/);return d&&d[1]?(d=d[1],void browsers.ajax("/al_friends.php",{method:"POST",data:"act=add&al=1&from=profile&hash="+d+"&mid="+a,success:function(){b&&browsers.ajax("/al_friends.php",{method:"POST",data:"act=request_text&al=1&hash="+d+"&message="+b+"&mid="+a,success:function(){}})}})):null}})},msgBox:function(a,c,d,e,f,g){return new window.MessageBox(b.isString(a)?{title:a}:a).content(c).setButtons(d,e,f,g).show()},pmStat:null,pmInfo:null,pmDate:null,pmMsgs:null,pmtraff:null,msgPerPage:200,xxsid:null,blocksState:JSON.parse(localStorage.musicsig_blocks||"{}"),saveBlocksState:function(){localStorage.musicsig_blocks=JSON.stringify(d.blocksState)},saveBlockTitle:function(){var c=a(this);if(!c.attr("data-title")){var d=c.find(".header_top"),e=d.find(".right_link"),f=d.text();e.length&&(f=f.replace(e.text(),"")),f=b.trim(f.replace(e.text(),"")),c.attr("data-title",f).data("title",f)}},patch2016BlocksLayout:function(){var b=a("#profile:not(.with-mono-block)");if(b.length){var c=b.find(".page_block:last-child").addClass("mono-block");b.find(".narrow_column .page_block .module").appendTo(c),b.addClass("with-mono-block")}},makeBlocksSortable:function(){var b=a("#profile_narrow, #profile .narrow_column"),e=b.find(".module[id]:not(.sortable)");if(e.length){e.each(d.saveBlockTitle),e.each(function(){var b=a(this),d=b.find(".header_top"),e=a("<img/>").addClass("handle sortable").attr("src",c.getiUrl("images/draggable.png")).click(function(a){a.preventDefault(),a.stopPropagation()});d.prepend(e)}),e.addClass("sortable").css({"background-color":"#fff"});var f=b.find(".sortable_blocks");f.length?f.sortable("destroy"):f=a("<div>").addClass("sortable_blocks");var g=b.find(".module:not([id])");g.length?f.insertBefore(g):f.appendTo(b),f.append(e),b.find(".module[id]").each(function(){for(var c=a(this),e=c.data("title"),f=d.blocksState[e]&&d.blocksState[e].previous||[],g=0;g<f.length;g++){var h=f[g],i=b.find('.module[data-title="'+h+'"]');if(i.length){c.prev().data("title")!==h&&c.insertAfter(i);break}}}),f.sortable({tolerance:"pointer",cursor:"url("+c.getiUrl("images/grabbing.png")+")",handle:".handle",axis:"y",stop:function(){b.find(".module.sortable[id]").each(function(){for(var b=a(this),c=b.prev(),e=b.data("title"),f=[];c.length;)f.push(c.data("title")),c=c.prev();var g=d.blocksState[e]||{};g.previous=f,d.blocksState[e]=g}),d.saveBlocksState()}})}},makeBlocksTogglable:function(){var b=a("#profile_narrow, #profile .narrow_column"),e=b.find(".module[id]:not(.togglable)");e.length&&(e.each(d.saveBlockTitle),e.each(function(){var b=a(this),e=b.data("title"),f=d.blocksState[e]&&d.blocksState[e].collapsed,g=b.find(".module_body"),h=b.find(".header_top"),i=a("<img/>").addClass("handle togglable").attr("src",c.getiUrl("images/wikiextarr.gif")).click(function(a){b.toggleClass("collapsed"),g.toggle("blind",200),f=b.is(".collapsed");var c=d.blocksState[e]||{};c.collapsed=f,d.blocksState[e]=c,d.saveBlocksState(),a.preventDefault(),a.stopPropagation()});f&&(b.addClass("collapsed"),g.hide()),h.prepend(i)}),e.addClass("togglable"))},fixAllAwayUrls:function(){var a=location.href.match(/\/away\.php\?.*to=([^&]*)(&post=\d+_\d+)?/);a&&a[1]&&(a=decodeURIComponent(a[1]),-1===a.indexOf("%")&&(location.href=a))},copyright:function(){a("#bFooter p, #footer div:eq(1)").append(a('<small> [<a href="https://vk.com/musicsigvk">MusicSig</a>]</small>'))}};return d},exports);