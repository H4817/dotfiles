"use strict";var exports,browsers={modules:{},paths:{jquery:"../lib/jquery/dist/jquery.min",jqueryui:"../lib/jquery-ui/jquery-ui.min",highlight:"../lib/highlightjs/highlight.min.pack"},globals:{jquery:"jQuery",highlight:"hljs"},isRequireJs:"function"==typeof define&&!!define.amd,isCommonsJs:"object"==typeof exports,isChrome:!!window.chrome,isFirefox:!!self.options,init:function(){if(browsers.isRequireJs&&(require.load=function(context,moduleName,url){var retries=0,xhr=new XMLHttpRequest,evalResponseText=function(xhr){eval(xhr.responseText),context.completeLoad(moduleName)};xhr.timeout=1e4,xhr.ontimeout=function(){5>retries&&(xhr.open("GET",browsers.extension.getURL(url),!0),retries++)},xhr.open("GET",browsers.extension.getURL(url),!0),xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&evalResponseText.call(window,xhr)},xhr.send(null)},require.config({baseUrl:"scripts/",paths:browsers.paths})),browsers.isChrome){var port=browsers.runtime.chromePort=chrome.runtime.connect({name:"bus"});port.onMessage.addListener(function(a){if(a.replyTo)browsers.runtime.onMessageReply(a.replyTo,a);else if(a.event&&browsers.runtime.eventCallbacks[a.event]){var b=[];browsers.runtime.eventCallbacks[a.event].forEach(function(c){try{a.arguments?c.apply(null,a.arguments):c(a),b.push(c)}catch(d){}}),browsers.runtime.eventCallbacks[a.event]=b}})}browsers.isFirefox&&(browsers.i18n.ffDictionary=self.options.i18n&&JSON.parse(self.options.i18n)||{})},resolve:function(a){var b=browsers.paths[a]||"./"+a+".js";return browsers.modules[a]||(window[browsers.globals[a]]?browsers.modules[a]=window[browsers.globals[a]]:browsers.isCommonsJs&&(browsers.modules[a]=require(b+".js"))),browsers.modules[a]},require:function(a,b){if(browsers.isRequireJs)require(a,b);else{var c=[];a.forEach(function(a){c.push(browsers.resolve(a))}),b.apply(this,c)}},define:function(a,b,c,d){browsers.isRequireJs?define(a,b,c):browsers.require(b,function(){var b=browsers.modules[a]=c.apply(this,arguments);if(d)for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e])})},extension:{getURL:function(a){return browsers.isChrome&&chrome.extension.getURL(a)||browsers.isFirefox&&self.options.extensionUrl+a},getBackgroundPage:function(){return browsers.isChrome&&chrome.extension&&chrome.extension.getBackgroundPage()}},tabs:{get:function(a,b){return browsers.isChrome&&chrome.tabs.get(a,b)||browsers.isFirefox&&browsers.runtime.sendMessage("tabs.get",{tabId:a},b)},create:function(a){return browsers.isChrome&&chrome.tabs.create({url:a})||browsers.isFirefox&&browsers.runtime.sendMessage("tabs.create",{url:a})},update:function(a,b){return browsers.isChrome&&chrome.tabs.update(a,{url:b})||browsers.isFirefox&&browsers.runtime.sendMessage("tabs.update",{tabId:a,url:b})}},runtime:{messageCallbacks:{},eventCallbacks:{},chromePort:null,getUniqueMessageId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},sendMessage:function(a,b,c){if(b=b||{},b.guid=browsers.runtime.getUniqueMessageId(),browsers.isChrome){b.action=a;var d=browsers.runtime.chromePort;c&&a&&(browsers.runtime.messageCallbacks[a]||(browsers.runtime.messageCallbacks[a]={}),browsers.runtime.messageCallbacks[a][b.guid]=c),d.postMessage(b)}browsers.isFirefox&&self.port&&(c&&a&&(browsers.runtime.messageCallbacks[a]||(self.port.on(a+".reply",function(b){browsers.runtime.onMessageReply(a,b)}),browsers.runtime.messageCallbacks[a]={}),browsers.runtime.messageCallbacks[a][b.guid]=c),self.port.emit(a,b))},onMessageReply:function(a,b){browsers.runtime.messageCallbacks[a]&&browsers.runtime.messageCallbacks[a][b.guid]&&(browsers.runtime.messageCallbacks[a][b.guid](b.payload),browsers.runtime.messageCallbacks[a][b.guid]=null)},onMessage:function(a,b){browsers.runtime.eventCallbacks[a]||(browsers.runtime.eventCallbacks[a]=[],browsers.isFirefox&&self.port.on(a,function(b){var c=[];browsers.runtime.eventCallbacks[a].forEach(function(a){try{b.arguments?a.apply(null,b.arguments):a(b),c.push(a)}catch(d){}}),browsers.runtime.eventCallbacks[a]=c})),browsers.runtime.eventCallbacks[a].push(b)}},i18n:{ffDictionary:{},getMessage:function(a){return browsers.isChrome&&chrome.i18n.getMessage(a)||browsers.isFirefox&&browsers.i18n.ffDictionary[a]&&browsers.i18n.ffDictionary[a].message||a},loadDictionary:function(a){browsers.isChrome&&a(),browsers.isFirefox&&("lngid"!==browsers.i18n.getMessage("lngid")?a():browsers.runtime.sendMessage("loadDictionary",{},function(b){browsers.i18n.ffDictionary=b,a()}))}},browserAction:{setIcon:function(a){return browsers.isChrome&&chrome.browserAction.setIcon({path:a})||browsers.isFirefox&&browsers.runtime.sendMessage("setIcon",{path:a})},setBadgeText:function(a){return browsers.isChrome&&chrome.browserAction.setBadgeText({text:a})||browsers.isFirefox&&browsers.runtime.sendMessage("setBadgeText",{text:a})},setBadgeBackgroundColor:function(a){return browsers.isChrome&&chrome.browserAction.setBadgeBackgroundColor({color:a})||browsers.isFirefox&&browsers.runtime.sendMessage("setBadgeBackgroundColor",{color:a})}},ajax:function(a,b){0!==a.indexOf("http")&&(a="https://vk.com/"+a.replace(/^\//,"")),b=b||{},browsers.isChrome?browsers.require(["jquery"],function(c){var d=b.success||function(){};b.success&&delete b.success,c.ajax(a,b).success(function(a,b,c){var e=c.getAllResponseHeaders().split(/\r\n?/);c.headers={},e.forEach(function(a){var b=a.match(/^([\w\d\-]+)\s*:\s*(.*)$/);b&&(c.headers[b[1].toLowerCase()]=b[2])}),d(a,c)})}):browsers.isFirefox&&(b.url=a,browsers.runtime.sendMessage("ajax",b,function(a){var c=a.text;"json"===b.dataType&&(c=a.json),b.success&&b.success(c,a)}))}};browsers.init(),browsers.define("browsers",[],function(){return browsers},exports||null);