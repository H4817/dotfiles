"use strict";var exports={},bootDeps=["config","jquery","utils","musicsig","downloads","video","observers","vkontakte","hiddenprofile","usermenu","calendar"];browsers.isChrome,browsers.define("bootstrap",bootDeps,function(a,b,c,d,e,f,g,h,i,j,k){var l;return l={basedomain:"",altdomain:"",initmsx:!1,config:a,settingsPage:[["Main","directLinks","antiAds","dwLinks","bestAudio","bitrateAlways"],["MainMenu","correctMenu","advMenu","advUserMenu","lockMenu","fixtopmenu","addCalendar","addClock","miComments"],["Profile","userYears","showZodiac","slideTabs"],["Delete","delRate","delAddInfo"]],init:function(){var a=location.host.match(/[^\.]+\.[^\.]+$/);a&&a[1]&&(l.basedomain=a[1]),l.altdomain="vk.com"===l.basedomain?"vkontakte.ru":"vk.com",l.loadCfg(l.enableFeatures),b(document).ready(l.onDocumentReady)},requestedSettingsLink:null,renderSettingsPage:function(){if("/settings.php"===location.pathname&&(location.pathname="/settings"),"/settings"===location.pathname){if(!window.content)return null;var a,c=function(a){if(a=a.split("?"),a=a[1],!a)return[];-1!==a.indexOf("#")&&(a=a.substr(0,a.indexOf("#")));for(var b=a.split("&"),c=[],d=0;d<b.length;d++)a=b[d].split("="),c[a[0]]=a[1];return c},e=c(location.href),f=function(a){return a&&a.replace(/^http(s)?:\/\/\w+\.\w+/,"")},g="musicsig"===e.act&&(!l.requestedSettingsLink||f(l.requestedSettingsLink)===f(location.href)),h=!!b(".wide_column_left").length,i=function(){a=b("#settings_panel, #wide_column");var c=b("#settingsMusicSig");if(a.length&&!c.length){var e=b("<div></div>").attr("id","settingsMusicSig").addClass("settings_section page_block clear_fix").toggleClass("post-2016-layout",h);b("<h2>").text(d.lang("mssettings")).appendTo(e);var f=b("<form>").attr("id","MusicSigSettings").attr("name","MusicSigSettings").appendTo(e),g=b("<table>").addClass("editor").attr("border","0").attr("cellspacing","0").appendTo(f);b("<button>").appendTo(e).wrap('<div class="button_blue"></div>').text(d.lang("save")).click(l.saveSettings),e.appendTo(a),a.children().hide(),e.show();for(var i=function(a){var c=b("<tr>").appendTo(g),d=b("<td>").attr("colspan","3").appendTo(c);b("<h2>").text(a).appendTo(d)},j=function(a,c,d){var e=b("<tr>").appendTo(g);b("<td>").addClass("label").text(c).appendTo(e);var f=b("<td>").addClass("input").appendTo(e),h=b("<input/>").attr("id","b_"+a).attr("name","b_"+a).attr("value","1").attr("type","checkbox").appendTo(f);l.config[a]&&h.attr("checked","checked"),b("<td>").addClass("description").text(d).appendTo(e)},k=0;k<l.settingsPage.length;k++){i(d.lang("cfg"+l.settingsPage[k][0]));for(var m=1;m<l.settingsPage[k].length;m++)j(l.settingsPage[k][m],d.lang(l.settingsPage[k][m]),d.lang(l.settingsPage[k][m]+"d"))}}},j=b("#tabMusicSig");j.length||(h?(j=b("<a></a>").attr("id","tabMusicSig").attr("href","/setings?act=musicsig").addClass("ui_rmenu_item").attr("onclick","return uiRightMenu.switchMenu(this);").click(function(){window.history.pushState({},null,"/settings?act=musicsig"),i()}).html("<span>MusicSig</span>"),b(".page_block.ui_rmenu.ui_rmenu_pr").append(j),b(".page_block.ui_rmenu.ui_rmenu_pr > a, #top_profile_menu > a").click(function(){l.requestedSettingsLink=this.getAttribute("href")})):(j=b("<li></li>").attr("id","tabMusicSig").html('<a href="/settings?act=musicsig" onclick="return checkEvent(event);" onmousedown="return Settings.go(this, event)"><b class="tl1"><b></b></b><b class="tl2"></b><b class="tab_word" id="MusicSigBt">MusicSig</b></a>'),b("#settings_filters").append(j),b("#settings_filters > li > a, #side_bar li > a, #exusm li > a").click(function(){l.requestedSettingsLink=this.getAttribute("href")}))),g&&(h||j.is(".active_link")?h&&!j.is(".ui_rmenu_item_sel")&&(b("a.ui_rmenu_item_sel").removeClass("ui_rmenu_item_sel"),j.addClass("ui_rmenu_item_sel")):(b("li.active_link").removeClass("active_link"),j.addClass("active_link")),i())}},saveSettings:function(){for(var a in l.config)a&&d.ge("b_"+a)&&(l.config[a]=d.ge("b_"+a).checked?1:0);return l.saveCfg(),location.reload(),!1},saveCfg:function(c){c=c||l.config,b.extend(a,l.config),d.bgSetVal("MusicSig",JSON.stringify(c)),localStorage.cfg&&(localStorage.cfg="",delete localStorage.cfg)},loadCfg:function(e){d.bgGetVal("MusicSig",function(d){if(d)if(/^\d+$/.test(d)){var f=0;for(var g in l.config){if(!l.config.hasOwnProperty(g)||void 0===d[f])break;l.config[g]=parseInt(d[f++])}l.saveCfg()}else{var h=c.keys(l.config);if(c.isString(d))try{var i=JSON.parse(d);l.config=c.pick(i,h)}catch(j){l.saveCfg()}else c.isObject(d)&&(l.config=c.pick(d,h))}else l.saveCfg();l.config=b.extend(a,l.config),e&&e(l.config)})},onDocumentReady:function(){},enableFeatures:function(){g.watchDocument();var a=[];a.push(d.getDesignLayout());var c=b("body");if(l.config.directLinks&&h.fixAllAwayUrls(),l.config.fixtopmenu&&a.push("musicsig-fix_top_menu"),l.config.antiAds&&a.push("musicsig-remove_ads"),l.config.lockMenu&&a.push("musicsig-fix_side_menu"),l.config.delRate&&a.push("musicsig-hide_rating"),l.config.delAddInfo&&a.push("musicsig-hide_rating_suggestions"),l.config.miComments&&j.addMenuItem(null,"li",d.lang("mycomments"),"/feed?section=comments",0,"msig_comm"),l.config.correctMenu&&j.hideMyFromMenu(),(l.config.advUserMenu||l.config.advMenu)&&j.initExtendedUserMenu(),l.config.advMenu&&(j.addSideMenuSubItems(),a.push("musicsig-advanced_menu")),l.config.addClock&&(b(document).on("MusicSig.disableClock",function(){l.config.addClock=0,l.saveCfg()}),k.addClock()),l.config.addCalendar&&(b(document).on("MusicSig.disableCalendar",function(){l.config.addCalendar=0,l.saveCfg()}),k.addCalendar()),l.config.bitrateAlways&&a.push("audio-extended"),a.length){var m=a.join(" ");c.addClass(m),g.watchSelector("body",{attributes:!0},function(){c.addClass(m)},"features-observed",0)}var n=function(){l.config.slideTabs&&(h.patch2016BlocksLayout(),h.makeBlocksSortable(),h.makeBlocksTogglable()),l.config.advUserMenu&&j.addMenuToUserLinks(),(l.config.userYears||l.config.showZodiac)&&i.addUserYears(),l.config.dwLinks&&(l.config.bestAudio&&e.addBitrateFilterControl(),e.addSideDownloadControls()),l.renderSettingsPage();var a=b("table.audio_table, .wide_column_left");a.length&&!a.attr("id")&&a.attr("id",location.pathname.substr(1))};g.watchSelector("body",{subtree:!0,childList:!0,attributes:!0},n,"page_body-observed"),l.config.dwLinks&&(e.observeAudio(),f.observeVideo())}}},exports);