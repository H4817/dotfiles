function getQueue(a,b,c,d,e,f){f=f||"timeout";var g=parseInt(a["MusicSig.downloadQueue.interval"])||5,h=a["MusicSig.downloadQueue.reloadMode"]||"restore",i=a["MusicSig.downloadQueue.items"],j=i&&"flush"!==h?JSON.parse(i)||[]:[],k=0,l={renderBadge:function(){c&&c.setBadge("downloads",j.length,k?[94,130,168,255]:[50,50,50,255],!0)},storeQueue:function(){a["MusicSig.downloadQueue.items"]="flush"!==h&&j.length?JSON.stringify(j):""},push:function(a){"object"==typeof a&&void 0!==a.length?(j=j.concat(a),l.trigger("MusicSig.downloadQueue.pushedItems",[a])):(j.push(a),l.trigger("MusicSig.downloadQueue.pushedItem",[a])),j.length&&!k&&l.start(),l.storeQueue(),l.renderBadge()},start:function(){l.downloadNext()},stop:function(){k&&("timeout"===f&&b.clearTimeout(k),k=0,l.trigger("MusicSig.downloadQueue.downloadStopped")),l.renderBadge()},clear:function(){l.stop(),j=[],l.trigger("MusicSig.downloadQueue.queueCleared"),l.renderBadge(),l.storeQueue()},downloadNext:function(){var a=j.shift();a&&(d(a.url,a.filename,"timeout"!==f&&function(){l.isOn()&&l.downloadNext()}),l.trigger("MusicSig.downloadQueue.downloadStarted",[a])),k=j.length?"timeout"===f?b.setTimeout(l.downloadNext,1e3*g):1:0,l.renderBadge(),l.storeQueue()},isOn:function(){return!!k},getInterval:function(){return g},setInterval:function(b){return g=parseInt(b)||5,a["MusicSig.downloadQueue.interval"]=g,g},getReloadMode:function(){return h},setReloadMode:function(b){return h=b||"restore",a["MusicSig.downloadQueue.reloadMode"]=h,l.storeQueue(),h},getItems:function(){return j},getTotal:function(){return j.length},trigger:function(a,b){e&&e(a,b)},getState:function(){return{queue:j,reloadMode:h,queueMode:f,interval:g,timeout:!!k}},getApi:function(){var a=["renderBadge","storeQueue","push","start","stop","clear","setInterval","setReloadMode","getState"],b={};return a.forEach(function(a){b[a]=l[a]}),b}};return l.renderBadge(),l}function Notifications(a,b,c,d,e,f){var g={links:{indexp:{link:"http://vk.com/id0"},friends:{link:"http://vk.com/friends?section=all_requests",count:0,enabled:!0},photos:{link:"http://vk.com/albums",count:0,enabled:!1},videos:{link:"http://vk.com/video?section=tagged",count:0,enabled:!1},messages:{link:"http://vk.com/mail?filter=new",count:0,enabled:!0},notes:{link:"http://vk.com/notes.php?act=comms",count:0,enabled:!0},groups:{link:"http://vk.com/groups",count:0,enabled:!0},news:{link:"http://vk.com/feed"},comments:{link:"http://vk.com/feed?section=comments"}},settings:{active:{link:"/../",count:0,enabled:!0},checktime:{type:"input",value:60,min:10,inputType:"number",unit:"sec"},music:{link:"http://vk.com/",count:0,enabled:!1},settings:{link:"options.html"},about:{link:"http://vk.com/musicsigvk"}},trigger:e,onMessage:function(a){g.trigger=a},timout:null,oldMessages:0,oldTotal:0,init:function(){g.refresh()},cfg:function(b,c){return void 0===a[b]&&void 0!==c&&(a[b]=c),a[b]},getLinks:function(){for(var b in g.links)g.links.hasOwnProperty(b)&&void 0!==g.links[b].enabled&&(g.links[b].enabled=void 0!==a[b]?!!a[b]:g.links[b].enabled);return g.links},getSettings:function(){for(var b in g.settings)g.settings.hasOwnProperty(b)&&("input"===g.settings[b].type?g.settings[b].value=void 0!==a[b]?a[b]:g.settings[b].value:void 0!==g.settings[b].enabled&&(g.settings[b].enabled=void 0!==a[b]?!!a[b]:g.settings[b].enabled));return g.settings},reCalcTotal:function(){var a=0,b=g.getLinks();for(var c in b)b.hasOwnProperty(c)&&void 0!==b[c].count&&b[c].enabled&&(a+=b[c].count);g.trigger&&g.trigger("MusicSig.Notifications.links",[b]),g.showEventsCount(a),g.cfg("music","true")&&(g.oldTotal<a&&f&&f(),g.oldTotal=a),g.cfg("notify","true")&&(g.oldMessages<b.messages.count,g.oldMessages=b.messages.count)},setUpdateTimer:function(){g.timout&&b.clearTimeout(g.timout);var c=parseInt(a.checktime);(10>c||isNaN(c))&&(c=10,a.checktime=10),g.timout=b.setTimeout(g.refresh,1e3*c)},refresh:function(){if(!g.cfg("active","true"))return g.showEventsCount(0),!0;var b="http://vk.com/feed2.php";d(b,function(b){if(b){a.vkid=b.user&&b.user.id;var c=g.links;for(var d in c)c.hasOwnProperty(d)&&-1!==c[d].count&&(c[d].count=b[d]&&b[d].count||0);g.reCalcTotal()}}),g.setUpdateTimer()},showEventsCount:function(a){a=parseInt(a),c.setBadge("notifications",a,[200,50,50,255])}};for(var h in g)g.hasOwnProperty(h)&&(this[h]=g[h]);this.init()}var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName?(b.parentNode.removeChild(b),!0):void 0})}function e(a){var b=getOwn(x.paths,a);return b&&isArray(b)&&b.length>1?(b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0):void 0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(apsp.apply(B,[B.length,0].concat(globalDefQueue)),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(g){a=g}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad&&req.onResourceLoad(u,this.map,this.depMaps)),l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);return e(b.id)?void 0:j(makeError("scripterror","Script error for: "+b.id,a,[b.id]))}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){return"interactive"===a.readyState?interactiveScript=a:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.18",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){return head||(head=a.parentNode),dataMain=a.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this);var exports,browsers={modules:{},paths:{jquery:"../lib/jquery/dist/jquery.min",jqueryui:"../lib/jquery-ui/jquery-ui.min",highlight:"../lib/highlightjs/highlight.min.pack"},globals:{jquery:"jQuery",highlight:"hljs"},isRequireJs:"function"==typeof define&&!!define.amd,isCommonsJs:"object"==typeof exports,isChrome:!!window.chrome,isFirefox:!!self.options,init:function(){if(browsers.isRequireJs&&(require.load=function(context,moduleName,url){var retries=0,xhr=new XMLHttpRequest,evalResponseText=function(xhr){eval(xhr.responseText),context.completeLoad(moduleName)};xhr.timeout=1e4,xhr.ontimeout=function(){5>retries&&(xhr.open("GET",browsers.extension.getURL(url),!0),retries++)},xhr.open("GET",browsers.extension.getURL(url),!0),xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&evalResponseText.call(window,xhr)},xhr.send(null)},require.config({baseUrl:"scripts/",paths:browsers.paths})),browsers.isChrome){var port=browsers.runtime.chromePort=chrome.runtime.connect({name:"bus"});port.onMessage.addListener(function(a){if(a.replyTo)browsers.runtime.onMessageReply(a.replyTo,a);else if(a.event&&browsers.runtime.eventCallbacks[a.event]){var b=[];browsers.runtime.eventCallbacks[a.event].forEach(function(c){try{a.arguments?c.apply(null,a.arguments):c(a),b.push(c)}catch(d){}}),browsers.runtime.eventCallbacks[a.event]=b}})}browsers.isFirefox&&(browsers.i18n.ffDictionary=self.options.i18n&&JSON.parse(self.options.i18n)||{})},resolve:function(a){var b=browsers.paths[a]||"./"+a+".js";return browsers.modules[a]||(window[browsers.globals[a]]?browsers.modules[a]=window[browsers.globals[a]]:browsers.isCommonsJs&&(browsers.modules[a]=require(b+".js"))),browsers.modules[a]},require:function(a,b){if(browsers.isRequireJs)require(a,b);else{var c=[];a.forEach(function(a){c.push(browsers.resolve(a))}),b.apply(this,c)}},define:function(a,b,c,d){browsers.isRequireJs?define(a,b,c):browsers.require(b,function(){var b=browsers.modules[a]=c.apply(this,arguments);if(d)for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e])})},extension:{getURL:function(a){return browsers.isChrome&&chrome.extension.getURL(a)||browsers.isFirefox&&self.options.extensionUrl+a},getBackgroundPage:function(){return browsers.isChrome&&chrome.extension&&chrome.extension.getBackgroundPage()}},tabs:{get:function(a,b){return browsers.isChrome&&chrome.tabs.get(a,b)||browsers.isFirefox&&browsers.runtime.sendMessage("tabs.get",{tabId:a},b)},create:function(a){return browsers.isChrome&&chrome.tabs.create({url:a})||browsers.isFirefox&&browsers.runtime.sendMessage("tabs.create",{url:a})},update:function(a,b){return browsers.isChrome&&chrome.tabs.update(a,{url:b})||browsers.isFirefox&&browsers.runtime.sendMessage("tabs.update",{tabId:a,url:b})}},runtime:{messageCallbacks:{},eventCallbacks:{},chromePort:null,getUniqueMessageId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},sendMessage:function(a,b,c){if(b=b||{},b.guid=browsers.runtime.getUniqueMessageId(),browsers.isChrome){b.action=a;var d=browsers.runtime.chromePort;c&&a&&(browsers.runtime.messageCallbacks[a]||(browsers.runtime.messageCallbacks[a]={}),browsers.runtime.messageCallbacks[a][b.guid]=c),d.postMessage(b)}browsers.isFirefox&&self.port&&(c&&a&&(browsers.runtime.messageCallbacks[a]||(self.port.on(a+".reply",function(b){browsers.runtime.onMessageReply(a,b)}),browsers.runtime.messageCallbacks[a]={}),browsers.runtime.messageCallbacks[a][b.guid]=c),self.port.emit(a,b))},onMessageReply:function(a,b){browsers.runtime.messageCallbacks[a]&&browsers.runtime.messageCallbacks[a][b.guid]&&(browsers.runtime.messageCallbacks[a][b.guid](b.payload),browsers.runtime.messageCallbacks[a][b.guid]=null)},onMessage:function(a,b){browsers.runtime.eventCallbacks[a]||(browsers.runtime.eventCallbacks[a]=[],browsers.isFirefox&&self.port.on(a,function(b){var c=[];browsers.runtime.eventCallbacks[a].forEach(function(a){try{b.arguments?a.apply(null,b.arguments):a(b),c.push(a)}catch(d){}}),browsers.runtime.eventCallbacks[a]=c})),browsers.runtime.eventCallbacks[a].push(b)}},i18n:{ffDictionary:{},getMessage:function(a){return browsers.isChrome&&chrome.i18n.getMessage(a)||browsers.isFirefox&&browsers.i18n.ffDictionary[a]&&browsers.i18n.ffDictionary[a].message||a},loadDictionary:function(a){browsers.isChrome&&a(),browsers.isFirefox&&("lngid"!==browsers.i18n.getMessage("lngid")?a():browsers.runtime.sendMessage("loadDictionary",{},function(b){browsers.i18n.ffDictionary=b,a()}))}},browserAction:{setIcon:function(a){return browsers.isChrome&&chrome.browserAction.setIcon({path:a})||browsers.isFirefox&&browsers.runtime.sendMessage("setIcon",{path:a})},setBadgeText:function(a){return browsers.isChrome&&chrome.browserAction.setBadgeText({text:a})||browsers.isFirefox&&browsers.runtime.sendMessage("setBadgeText",{text:a})},setBadgeBackgroundColor:function(a){return browsers.isChrome&&chrome.browserAction.setBadgeBackgroundColor({color:a})||browsers.isFirefox&&browsers.runtime.sendMessage("setBadgeBackgroundColor",{color:a})}},ajax:function(a,b){0!==a.indexOf("http")&&(a="https://vk.com/"+a.replace(/^\//,"")),b=b||{},browsers.isChrome?browsers.require(["jquery"],function(c){var d=b.success||function(){};b.success&&delete b.success,c.ajax(a,b).success(function(a,b,c){var e=c.getAllResponseHeaders().split(/\r\n?/);c.headers={},e.forEach(function(a){var b=a.match(/^([\w\d\-]+)\s*:\s*(.*)$/);b&&(c.headers[b[1].toLowerCase()]=b[2])}),d(a,c)})}):browsers.isFirefox&&(b.url=a,browsers.runtime.sendMessage("ajax",b,function(a){var c=a.text;"json"===b.dataType&&(c=a.json),b.success&&b.success(c,a)}))}};browsers.init(),browsers.define("browsers",[],function(){return browsers},exports||null);var exports={};browsers.define("utils",[],function(){var a={trim:function(a){return a.replace(/(^\s+)|(\s+$)/g,"")},isObject:function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},isUndefined:function(a){return void 0===a},isString:function(a){return"string"==typeof a},isArray:function(a){return Array.isArray(a)},keys:function(a){return Object.keys(a)},pick:function(b,c){var d={};return(a.isString(c)?[c]:c).forEach(function(c){a.isUndefined(b[c])||(d[c]=b[c])}),d}};return a},exports);var Badges=function(a){var b={badges:{notifications:{text:0,color:[200,50,50,255]},downloads:{text:0,color:[50,50,200,255]}},currentBadgeId:"notifications",setCurrentBadge:function(a){b.setCurrentBadge=a},setBadge:function(a,c,d,e){var f=b.badges[a]||{};f.text=null!==c&&c+""||f.text,f.color=d||f.color,b.currentBadgeId&&b.badges[b.currentBadgeId].text&&"0"!==b.badges[b.currentBadgeId].text&&!e||(b.currentBadgeId=a),f.text&&"0"!==f.text||b.getNextBadgeId(),b.renderBadge()},renderBadge:function(c){c=c||b.currentBadgeId;var d=b.badges[c]||{text:0,color:[0,0,0,0]};a&&a(d.text&&"0"!==d.text?d.text+"":"",d.color||[200,50,50,255])},getNextBadgeId:function(){for(var a=Object.keys(b.badges),c=b.currentBadgeId?a.indexOf(b.currentBadgeId):0,d=b.currentBadgeId?1:0;d<a.length;d++){var e=a[(d+c)%a.length],f=b.badges[e]||{};if(f.text&&"0"!==f.text){b.currentBadgeId=e;break}}return b.currentBadgeId},badgeInterval:0,loopBadges:function(a){b.badgeInterval&&window.clearInterval(b.badgeInterval),b.badgeInterval=window.setInterval(function(){b.getNextBadgeId(),b.renderBadge()},a||1e4)}};for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);return this};if(exports&&(exports.Badges=Badges),define&&"function"==typeof define&&define.amd&&define("badges",[],function(){return new Badges(function(a,b){chrome.browserAction.setBadgeText({text:a}),chrome.browserAction.setBadgeBackgroundColor({color:b})})}),exports&&(exports.getQueue=getQueue),define&&"function"==typeof define&&define.amd&&define("download-queue",[],function(){return{getQueue:getQueue}}),exports&&(exports.Notifications=Notifications),define&&"function"==typeof define&&define.amd){try{var audioObj=new Audio("");audioObj.src=browsers.extension.getURL("notification.mp3"),audioObj.id="chat_sound",audioObj.load()}catch(err){}define("notifications",["jquery","badges"],function(a,b){return new Notifications(window.localStorage,window,b,function(b,c){a.ajax(b,{dataType:"text",success:function(a,b,d){if(200===d.status&&a)try{var e=JSON.parse(a);c(e)}catch(f){}}}).success()},null,function(){try{audioObj.play()}catch(a){}})})}var exports={};browsers.require(["badges","download-queue","notifications"],function(a,b,c){function d(a){var b=h.getApi();f.push(a),a.onMessage.addListener(function(c){var d=c.guid,e=c.action,f=i[e],g="MusicSig.downloadQueue.";if(f||0!==e.indexOf(g)||(f=b[e.substr(g.length)]),f){var h={guid:d,replyTo:e,payload:c.arguments?f.apply(null,c.arguments.concat([a])):f(c,a)};d&&h.payload!==!1&&a.postMessage(h)}})}chrome.runtime.onInstalled.addListener(function(a){console.log(a.previousVersion,"previousVersion")}),browsers.browserAction.setIcon("/images/icon/"+(parseInt(window.localStorage.icon)||0)+"_48.png");var e=function(a,b){var c;c=document.getElementById("linkHolder"),c||(c=document.createElement("div"),c.setAttribute("id","linkHolder"),document.body.appendChild(c));var d=document.createElement("a");d.href=a,d.setAttribute("download",b),d.textContent=b,c.appendChild(d),d.click()},f=[],g=function(a,b){b=b||[];var c=[];f.forEach(function(d){try{d.postMessage({event:a,arguments:b}),c.push(d)}catch(e){}}),f=c},h=b.getQueue(window.localStorage,window,a,e,g);"continue"===h.getReloadMode()&&h.start(),c.onMessage(g);var i={getval:function(a){var b=a.name;return localStorage[b]},setval:function(a){var b=a.name;return localStorage[b]=a.variable,localStorage[b]},download:function(a){e(a.url,a.filename)},downloadQueue:function(a){h.push(a.items)},setIcon:function(a){chrome.browserAction.setIcon(a.path)},setBadgeText:function(a){chrome.browserAction.setBadgeText(a.text)},setBadgeBackgroundColor:function(a){chrome.browserAction.setBadgeBackgroundColor(a.color)},getNotificationOptions:function(){return{links:c.getLinks(),settings:c.getSettings()}},refreshNotifications:function(){c.refresh()},mute:function(){localStorage.notify="",localStorage.music=""}};chrome.runtime.onConnect.addListener(function(a){d(a)})},exports);